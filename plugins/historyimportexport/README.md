# 历史记录导入导出插件

## 功能介绍

历史记录导入导出插件支持MoviePilot历史记录的备份和恢复功能，特别针对电视剧剧集提供了智能排序功能。

### 主要功能

1. **导出所有历史记录** - 将所有整理历史记录导出为JSON文件
2. **按电视剧分别导出** - 按电视剧分组，每个电视剧生成独立的JSON文件
3. **智能导入功能** - 支持从JSON文件导入历史记录，自动去重
4. **剧集时间排序** - 导入时可按剧集顺序重新排列时间，确保剧集按正确顺序显示
5. **文件管理** - 提供导出文件列表查看和下载功能

## 配置说明

### 基本配置

- **启用插件**: 开启或关闭插件功能
- **导出文件保存路径**: 设置导出文件的保存目录，默认为 `/tmp/history_export`
- **剧集时间间隔（分钟）**: 设置剧集之间的时间间隔，用于重新排列时间，默认30分钟
- **导入时自动按剧集排序**: 开启后，导入时会自动按季和集的顺序重新排列时间

## 使用方法

### 导出历史记录

1. 进入插件页面
2. 点击「导出所有历史记录」按钮导出全部记录
3. 或点击「按电视剧分别导出」按钮按电视剧分组导出
4. 导出完成后可在文件列表中查看和下载

### 导入历史记录

1. 准备JSON格式的历史记录文件
2. 在插件页面点击上传区域或拖拽文件
3. 选择文件后点击「导入」按钮
4. 如果开启了自动排序，电视剧剧集会按正确顺序重新排列时间

### 文件管理

- 在文件列表中可以查看所有导出的文件
- 点击下载按钮可以下载对应的文件
- 点击刷新按钮可以更新文件列表

## 技术特性

### 智能排序算法

- 按电视剧标题、年份、TMDB ID分组
- 按季数（Season）和集数（Episode）排序
- 根据设定的时间间隔重新分配时间戳
- 保持其他类型记录的原始时间

### 数据安全

- 导入时自动检测重复记录，避免数据重复
- 支持增量导入，只导入新的记录
- 完整保留原始记录的所有字段信息

### 文件格式

导出的JSON文件包含完整的TransferHistory记录信息：

```json
[
  {
    "src": "源文件路径",
    "dest": "目标文件路径",
    "title": "媒体标题",
    "year": "年份",
    "type": "类型（电影/电视剧）",
    "seasons": "季数",
    "episodes": "集数",
    "date": "整理时间",
    "tmdbid": "TMDB ID",
    ...
  }
]
```

## 注意事项

1. 导出文件较大时可能需要一些时间，请耐心等待
2. 导入时会跳过已存在的重复记录
3. 建议定期备份历史记录，以防数据丢失
4. 确保导出路径有足够的磁盘空间
5. 导入的JSON文件必须符合正确的格式

## 版本历史

### v1.0.0
- 支持历史记录导入导出功能
- 按电视剧分别导出
- 支持按剧集顺序重新排列时间
- 提供完整的Web UI界面
- 文件管理和下载功能